language: node_js
services:
  - mongodb
addons:
  sonarcloud:
    organization: "loopingz-github"
node_js:
  - "8"
before_script:
  - sleep 15
  - mongo webda-test --eval 'db.createUser({user:"travis",pwd:"test",roles:["readWrite"]});'
script:
  - npm run test
after_success:
  - npm run sonarcover
  - sonar-scanner
before_deploy:
  - npm run build
  - WEBDA_TEST_TARGET=lib/ npm run cover
deploy:
  provider: npm
  skip_cleanup: true
  on:
    tags: true